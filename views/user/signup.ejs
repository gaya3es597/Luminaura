
  
  <%- include('../partials/user/header') %>

<div class="container" style="max-width: 500px; margin: 50px auto;">
  <h2 class="text-center mb-4">Sign Up</h2>

  <form id="signupform" action="/signup" method="POST">
    <div class="form-group mb-3">
      <label for="fullName">Full Name</label>
      <input type="text" class="form-control" name="name" id="name" required>
      <div id="name-error" class="error-message">

      </div>
    </div>

    <div class="form-group mb-3">
      <label for="email">Email address</label>
      <input type="email" class="form-control" name="email" id="email" required>
       <div id="email-error" class="error-message">

      </div>
    </div>

    <div class="form-group mb-3">
      <label for="phone">Phone Number</label>
      <input type="tel" class="form-control" name="phone" id="phone" required>
       <div id="phone-error" class="error-message">

      </div>
    </div>

    <div class="form-group mb-3">
      <label for="password">Password</label>
      <input type="password" class="form-control" name="password" id="password" required>
       <div id="password-error" class="error-message">
      </div>
    </div>

    <div class="form-group mb-4">
      <label for="confirmPassword">Confirm Password</label>
      <input type="password" class="form-control" name="confirmPassword" id="confirmPassword" required>
       <div id="confirmpass-error" class="error-message">
      </div>
       <% if(locals.message && message.length>0) { %>
            <div class="alert alert-danger text-center">
                <%=message%>
            </div>
         <% } %>
    </div>
    <div id="error6" class="error-message"></div>
        <input type="text" id="referralCode" name="referralCode" placeholder="Referral Code (Optional)" />


    <button type="submit" class="btn btn-primary w-100">Sign Up</button>
  </form>

  <div class="text-center my-3">
    <span>or</span>
  </div>

  <a href="/auth/google" class="btn btn-danger w-100 mb-3">
    <i class="fab fa-google me-2"></i> Sign up with Google
  </a>

  <div class="text-center">
    <a href="/forgot-password">Forgot Password?</a>
  </div>
</div>

<%- include('../partials/user/footer') %>

<!-- FORM VALIDATION -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const nameid = document.getElementById('name');
    const emailid = document.getElementById('email');
    const phoneid = document.getElementById('phone');
    const passid = document.getElementById('password');
    const cpassid = document.getElementById('confirmPassword');
    const referralCodeId = document.getElementById('referralCode');
    const nameError = document.getElementById('name-error');
    const emailError = document.getElementById('email-error');
    const phoneError = document.getElementById('phone-error');
    const passwordError = document.getElementById('password-error');
    const cpassError = document.getElementById('confirmpass-error');

    const signupform = document.getElementById('signupform');

    if (!nameid || !emailid || !phoneid || !passid || !cpassid || !signupform) {
      console.error("❌ One or more elements not found in DOM.");
      return;
    }
     function referralValidateChecking() {
          const refVal = referralCodeId.value.trim();
          const pattern = /^[a-zA-Z0-9]*$/;

          if (refVal && !pattern.test(refVal)) {
            error6.style.display = 'block';
            error6.innerHTML = 'Referral code can only contain letters and numbers';
          } else {
            error6.style.display = 'none';
            error6.innerHTML = '';
          }
        }

    function nameValidateChecking() {
      const nameval = nameid.value.trim();
      const namepattern = /^[A-Za-z\s]+$/;
      if (nameval === "") {
        nameError.style.display = "block";
        nameError.innerHTML = "Please enter a valid name";
        return false;
      } else if (!namepattern.test(nameval)) {
        nameError.style.display = "block";
        nameError.innerHTML = "Name can only contain alphabets and spaces";
        return false;
      } else {
        nameError.style.display = "none";
        nameError.innerHTML = "";
        return true;
      }
    }

    function emailValidateChecking() {
      const emailval = emailid.value.trim();
      const emailpattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      if (!emailpattern.test(emailval)) {
        emailError.style.display = "block";
        emailError.innerHTML = "Invalid email format";
        return false;
      } else {
        emailError.style.display = "none";
        emailError.innerHTML = "";
        return true;
      }
    }

    function phoneValidateChecking() {
      const phoneval = phoneid.value.trim();
      if (phoneval === "") {
        phoneError.style.display = "block";
        phoneError.innerHTML = "Enter a valid phone number";
        return false;
      } else if (phoneval.length !== 10 || !/^\d+$/.test(phoneval)) {
        phoneError.style.display = "block";
        phoneError.innerHTML = "Enter a 10-digit phone number";
        return false;
      } else {
        phoneError.style.display = "none";
        phoneError.innerHTML = "";
        return true;
      }
    }

    function passwordValidateChecking() {
      const passwordval = passid.value;
      const cpassval = cpassid.value;
      const alpha = /[a-zA-Z]/;
      const digit = /\d/;
      let valid = true;

      if (passwordval.length < 8) {
        passwordError.style.display = "block";
        passwordError.innerHTML = "Should contain at least 8 characters";
        valid = false;
      } else if (!alpha.test(passwordval) || !digit.test(passwordval)) {
        passwordError.style.display = "block";
        passwordError.innerHTML = "Password should contain both letters and numbers";
        valid = false;
      } else {
        passwordError.style.display = "none";
        passwordError.innerHTML = "";
      }

      if (passwordval !== cpassval) {
        cpassError.style.display = "block";
        cpassError.innerHTML = "Passwords do not match";
        valid = false;
      } else {
        cpassError.style.display = "none";
        cpassError.innerHTML = "";
      }

      return valid;
    }

    // ✅ Real-time validation on blur
    nameid.addEventListener("blur", nameValidateChecking);
    emailid.addEventListener("blur", emailValidateChecking);
    phoneid.addEventListener("blur", phoneValidateChecking);
    passid.addEventListener("blur", passwordValidateChecking);
    cpassid.addEventListener("blur", passwordValidateChecking);

    // ✅ Final form validation before submission
    signupform.addEventListener("submit", function (e) {
      const nameValid = nameValidateChecking();
      const emailValid = emailValidateChecking();
      const phoneValid = phoneValidateChecking();
      const passValid = passwordValidateChecking();
      const referralValid = referralValidateChecking();
       

      if (!nameValid || !emailValid || !phoneValid || !passValid) {
        e.preventDefault();
        console.warn("Validation failed — form not submitted.");
      }
    });
  });
</script>




